/*
* File:        jquery.dataTables.grouping.min.js
* Version:     1.0.
* Author:      Jovan Popovic 
* Copyright 2011 Jovan Popovic, all rights reserved.
* This source file is free software, under either the GPL v2 license or a
* BSD style license, as supplied with this software.
* This source file is distributed in the hope that it will be useful, but 
* WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY 
* or FITNESS FOR A PARTICULAR PURPOSE.  
*/
(function(a){a.fn.rowGrouping=function(c){function b(){}function e(g){var f=["January","February","March","April","May","June","Jully","August","September","October","November","December"];return f[g-1]}var d={iGroupingColumnIndex:0,sGroupingColumnSortDirection:"",iGroupingOrderByColumnIndex:-1,sGrupingClass:"group",bHideGroupingColumn:true,bHideGroupingOrderByColumn:true,sGroupBy:"name",sGroupLabelPrefix:"",bExpandableGrouping:false,bExpandSingleGroup:false,iExpandGroupOffset:100,asExpandedGroups:null,sDateFormat:"dd/MM/yyyy",sEmptyGroupLabel:"-",bSetGroupingClassOnTR:false,iGroupingColumnIndex2:-1,sGroupingColumnSortDirection2:"",iGroupingOrderByColumnIndex2:-1,sGrupingClass2:"subgroup",bHideGroupingColumn2:true,bHideGroupingOrderByColumn2:true,sGroupBy2:"name",sGroupLabelPrefix2:"",bExpandableGrouping2:false,fnOnGrouped:b};return this.each(function(j,u){var s=a(u).dataTable();function r(i){return(a.inArray(i,f)!=-1)}function v(i){return i.substr(o,x)}function n(i){return i}function w(i){return i.substr(0,1)}function z(i){return v(i)}function q(i){return i.substr(o,x)+" "+e(i.substr(iMonthIndex,iMonthLength))}function l(i){return i.toLowerCase().replace(" ","-")}var o=6;var x=4;var f=new Array();var h=true;var k=a.extend(d,c);if(k.iGroupingOrderByColumnIndex==-1){k.bCustomColumnOrdering=false;k.iGroupingOrderByColumnIndex=k.iGroupingColumnIndex}else{k.bCustomColumnOrdering=true}if(k.sGroupingColumnSortDirection==""){if(k.sGroupBy=="year"){k.sGroupingColumnSortDirection="desc"}else{k.sGroupingColumnSortDirection="asc"}}if(k.iGroupingOrderByColumnIndex2==-1){k.bCustomColumnOrdering2=false;k.iGroupingOrderByColumnIndex2=k.iGroupingColumnIndex2}else{k.bCustomColumnOrdering2=true}if(k.sGroupingColumnSortDirection2==""){if(k.sGroupBy2=="year"){k.sGroupingColumnSortDirection2="desc"}else{k.sGroupingColumnSortDirection2="asc"}}if(k.asExpandedGroups!=null){if(k.asExpandedGroups=="NONE"){k.asExpandedGroups=[];f=k.asExpandedGroups;h=false}else{if(k.asExpandedGroups=="ALL"){}else{if(k.asExpandedGroups.constructor==String){var g=k.asExpandedGroups;k.asExpandedGroups=new Array();k.asExpandedGroups.push(l(g));f=k.asExpandedGroups;h=false}else{if(k.asExpandedGroups.constructor==Array){for(var t=0;t<k.asExpandedGroups.length;t++){f.push(l(k.asExpandedGroups[t]));if(k.bExpandSingleGroup){break}}h=false}}}}}o=k.sDateFormat.toLowerCase().indexOf("yy");x=k.sDateFormat.toLowerCase().lastIndexOf("y")-k.sDateFormat.toLowerCase().indexOf("y")+1;iMonthIndex=k.sDateFormat.toLowerCase().indexOf("mm");iMonthLength=k.sDateFormat.toLowerCase().lastIndexOf("m")-k.sDateFormat.toLowerCase().indexOf("m")+1;var y=n;switch(k.sGroupBy){case"letter":y=w;break;case"year":y=z;break;case"month":y=q;break;default:y=n;break}var p=function(A){var C=false;if(k.iGroupingColumnIndex2!=-1){C=true}if(A.aiDisplay.length==0){return}var P=a("tbody tr",s);var Q=P[0].getElementsByTagName("td").length;var E=null;var I=null;for(var G=0;G<P.length;G++){var K=A._iDisplayStart+G;var J="";var O=null;var F="";var H=null;J=A.aoData[A.aiDisplay[K]]._aData[k.iGroupingColumnIndex];var O=J;if(k.sGroupBy!="year"){O=y(J)}if(C){F=A.aoData[A.aiDisplay[K]]._aData[k.iGroupingColumnIndex2];if(k.sGroupBy2!="year"){H=y(F)}}if(E==null||O!=E){var M=l(O);if(k.bExpandableGrouping&&h){if(k.bExpandSingleGroup){if(f.length==0){f.push(M)}}else{f.push(M)}}var D=document.createElement("tr");var L=document.createElement("td");D.id="group-id-"+s.attr("id")+"-"+M;if(k.bSetGroupingClassOnTR){D.className=k.sGrupingClass+" "+M}else{L.className=k.sGrupingClass+" "+M}L.colSpan=Q;L.innerHTML=k.sGroupLabelPrefix+(O==""?k.sEmptyGroupLabel:O);if(k.bExpandableGrouping){if(r(M)){L.className+=" expanded-group"}else{L.className+=" collapsed-group"}L.className+=" group-item-expander";L.rel=M;a(L).click(function(W){var T=a(this).attr("rel");var U=r(T);if(k.bExpandSingleGroup){if(!U){var S=f[0];f=new Array();f.push(T);a(".group-item-"+S,s).hide();a(".group-item-"+T,s).show();var R=a(".expanded-group");R.removeClass("expanded-group");R.addClass("collapsed-group");a(this).addClass("expanded-group");a(this).removeClass("collapsed-group");if(k.iExpandGroupOffset!=-1){var i=a("#group-id-"+s.attr("id")+"-"+T).offset().top-k.iExpandGroupOffset;window.scroll(0,i)}else{var i=s.offset().top;window.scroll(0,i)}}}else{if(U){var V=a.inArray(T,f);f.splice(V,1);a(this).removeClass("expanded-group");a(this).addClass("collapsed-group");a(".group-item-"+T,s).hide()}else{f.push(T);a(this).addClass("expanded-group");a(this).removeClass("collapsed-group");a(".group-item-"+T,s).show()}}W.preventDefault()})}D.appendChild(L);P[G].parentNode.insertBefore(D,P[G]);E=O;I=null}if(k.bExpandableGrouping){a(P[G]).addClass("group-item-"+M);if(!r(M)){a(P[G]).hide()}}if(C){if(I==null||H!=I){var N=document.createElement("tr");var B=document.createElement("td");if(k.bSetGroupingClassOnTR){N.className=k.sGrupingClass2+" "+H.toLowerCase().replace(" ","-")}else{B.className=k.sGrupingClass2+" "+H.toLowerCase().replace(" ","-")}B.colSpan=Q;B.innerHTML=k.sGroupLabelPrefix2+(H==""?k.sEmptyGroupLabel:H);N.appendChild(B);P[G].parentNode.insertBefore(N,P[G]);I=H}}}k.fnOnGrouped();h=false};s.fnSetColumnVis(k.iGroupingColumnIndex,!k.bHideGroupingColumn);if(k.bCustomColumnOrdering){s.fnSetColumnVis(k.iGroupingOrderByColumnIndex,!k.bHideGroupingOrderByColumn)}if(k.iGroupingColumnIndex2!=-1){s.fnSetColumnVis(k.iGroupingColumnIndex2,!k.bHideGroupingColumn2)}if(k.bCustomColumnOrdering2){s.fnSetColumnVis(k.iGroupingOrderByColumnIndex2,!k.bHideGroupingOrderByColumn2)}s.fnSettings().aoDrawCallback.push({fn:p,sName:"fnRowGroupung"});var m=new Array();m.push([k.iGroupingOrderByColumnIndex,k.sGroupingColumnSortDirection]);if(k.iGroupingColumnIndex2!=-1){m.push([k.iGroupingOrderByColumnIndex2,k.sGroupingColumnSortDirection2])}s.fnSettings().aaSortingFixed=m;switch(k.sGroupBy){case"name":break;case"letter":s.fnSettings().aoColumns[k.iGroupingOrderByColumnIndex].sSortDataType="rg-letter";a.fn.dataTableExt.afnSortData["rg-letter"]=function(B,A){var i=[];a("td:eq("+A+")",B.oApi._fnGetTrNodes(B)).each(function(){i.push(w(this.innerHTML))});return i};break;case"year":s.fnSettings().aoColumns[k.iGroupingOrderByColumnIndex].sSortDataType="rg-date";a.fn.dataTableExt.afnSortData["rg-date"]=function(B,A){var i=[];a("td:eq("+A+")",B.oApi._fnGetTrNodes(B)).each(function(){i.push(v(this.innerHTML))});return i};break;default:break}if(k.sGroupBy=="name"||k.sGroupBy=="letter"){}else{}s.fnDraw()})}})(jQuery);
